name: Makefile CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    name: Build
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v3

    - uses: actions/setup-python@v4
      with:
        python-version: '3.10' 
    
    - uses: uraimo/run-on-arch-action@v2
      name: Run commands
      id: runcmd
      with:
        arch: armv7
        distro: ubuntu18.04

        # Set an output parameter `uname` for use in subsequent steps
        run: |
          uname -a
          echo ::set-output name=uname::$(uname -a)
          python -m pip install pybind11
          apt install -y libwiringpi
          make
          python -m pip wheel -w dist .

    # - name: Install pybind11
      # run: python3 -m pip install pybind11

    # - name: Install Wiring Pi
      # run: sudo apt install -y libwiringpi-dev

    # - name: Make
      # run: make
      
    # - name: Build wheels
      # run: python3 -m pip wheel -w dist .

    - uses: actions/upload-artifact@v2
      with:
        path: ./dist/*.whl
